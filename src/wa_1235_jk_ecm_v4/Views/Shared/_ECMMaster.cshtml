@using Microsoft.AspNetCore.Http
@using System.Text.Json
@using wa_1235_jk_ecm_v4.Models.DecintellCommon
@inject IHttpContextAccessor HttpContextAccessor
@inject IConfiguration Configuration
<!DOCTYPE html>
<!--
This is a starter template page. Use this page to start your new project from
scratch. This page gets rid of all links and provides the needed markup only.
-->
@{
    var uiRepository = Configuration["Decintell:UIRepository"];
}
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Decintell Tech Pvt. Ltd.</title>

    <style>
        /* Overlay to disable the page */
        #page-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent black */
            z-index: 9998; /* Slightly below the loader */
            display: none; /* Hidden by default */
        }

        /* Center the loader */
        #loader {
            position: absolute;
            left: 50%;
            top: 50%;
            z-index: 1;
            width: 120px;
            height: 120px;
            margin: -76px 0 0 -76px;
            border: 16px solid #f3f3f3;
            border-radius: 50%;
            border-top: 16px solid #3498db;
            -webkit-animation: spin 2s linear infinite;
            animation: spin 2s linear infinite;
        }

        @@-webkit-keyframes spin {
            0% {
                -webkit-transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
            }
        }

        @@keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Add animation to "page content" */
        .animate-bottom {
            position: relative;
            -webkit-animation-name: animatebottom;
            -webkit-animation-duration: 1s;
            animation-name: animatebottom;
            animation-duration: 1s
        }

        @@-webkit-keyframes animatebottom {
            from {
                bottom: -100px;
                opacity: 0
            }

            to {
                bottom: 0px;
                opacity: 1
            }
        }

        @@keyframes animatebottom {
            from {
                bottom: -100px;
                opacity: 0
            }

            to {
                bottom: 0;
                opacity: 1
            }
        }

    </style>

    <style>
        .disabledbutton {
            pointer-events: none;
            opacity: 0.4;
        }
    </style>

    <style>
        #notificationLink {
            cursor: pointer; /* Ensures the hand pointer on hover */
        }
    </style>

    <!-- Google Font: Source Sans Pro -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
    <!-- Font Awesome Icons -->

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">




    <!-- daterange picker -->
    <link rel="stylesheet" href="@($"{uiRepository}plugins/daterangepicker/daterangepicker.css")">

    <!-- DataTables -->
    <link rel="stylesheet" href="@($"{uiRepository}plugins/datatables-bs4/css/dataTables.bootstrap4.min.css")">
    <link rel="stylesheet" href="@($"{uiRepository}plugins/datatables-responsive/css/responsive.bootstrap4.min.css")">
    <link rel="stylesheet" href="@($"{uiRepository}plugins/datatables-buttons/css/buttons.bootstrap4.min.css")">
    <link rel="stylesheet" href="@($"{uiRepository}plugins/summernote/summernote-bs4.min.css")">



    <!-- iCheck for checkboxes and radio inputs -->
    <link rel="stylesheet" href="@($"{uiRepository}plugins/icheck-bootstrap/icheck-bootstrap.min.css")">
    <!-- Bootstrap Color Picker -->
    <link rel="stylesheet" href="@($"{uiRepository}plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css")">
    <!-- Tempusdominus Bootstrap 4 -->
    <link rel="stylesheet" href="@($"{uiRepository}plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css")">
    <!-- Select2 -->
    <link rel="stylesheet" href="@($"{uiRepository}plugins/select2/css/select2.min.css")">
    <link rel="stylesheet" href="@($"{uiRepository}plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css")">
    <!-- Bootstrap4 Duallistbox -->
    <link rel="stylesheet" href="@($"{uiRepository}plugins/bootstrap4-duallistbox/bootstrap-duallistbox.min.css")">
    <!-- BS Stepper -->
    <link rel="stylesheet" href="@($"{uiRepository}plugins/bs-stepper/css/bs-stepper.min.css")">
    <!-- dropzonejs -->
    <link rel="stylesheet" href="@($"{uiRepository}plugins/dropzone/min/dropzone.min.css")">


    <!-- Theme style -->
    <link rel="stylesheet" href="@($"{uiRepository}dist/css/adminlte.min.css")">

    <!--Gantt chart -->
    <link rel="stylesheet" type="text/css" href="@($"{uiRepository}Html-elements/source/styles/smart.default.css")" />
    <link rel="stylesheet" type="text/css" href="@($"{uiRepository}Html-elements/timeline-header/styles.css")" />
    <script src="@($"{uiRepository}Html-elements/source/modules/smart.ganttchart.js")"></script>
    <!-- jQuery -->
    <script src="@($"{uiRepository}plugins/jquery/jquery.min.js")"></script>
    <script src="@($"{uiRepository}plugins/summernote/summernote-bs4.min.js")"></script>
    <script src="@($"{uiRepository}plugins/moment/moment.min.js")"></script>

    <!-- DataTables  & Plugins -->
    <script src="@($"{uiRepository}plugins/datatables/jquery.dataTables.min.js")"></script>
    <script src="@($"{uiRepository}plugins/datatables-bs4/js/dataTables.bootstrap4.min.js")"></script>
    <script src="@($"{uiRepository}plugins/datatables-responsive/js/dataTables.responsive.min.js")"></script>
    <script src="@($"{uiRepository}plugins/datatables-responsive/js/responsive.bootstrap4.min.js")"></script>
    <script src="@($"{uiRepository}plugins/datatables-buttons/js/dataTables.buttons.min.js")"></script>
    <script src="@($"{uiRepository}plugins/datatables-buttons/js/buttons.bootstrap4.min.js")"></script>
    <script src="@($"{uiRepository}plugins/jszip/jszip.min.js")"></script>
    <script src="@($"{uiRepository}plugins/pdfmake/pdfmake.min.js")"></script>
    <script src="@($"{uiRepository}plugins/pdfmake/vfs_fonts.js")"></script>
    <script src="@($"{uiRepository}plugins/datatables-buttons/js/buttons.html5.min.js")"></script>
    <script src="@($"{uiRepository}plugins/datatables-buttons/js/buttons.print.min.js")"></script>
    <script src="@($"{uiRepository}plugins/datatables-buttons/js/buttons.colVis.min.js")"></script>

    <!-- Customised style -->
    <link rel="stylesheet" href="@($"{uiRepository}dist/css/style.css")">
  
    <style>
        .carousel-inner {
            overflow-x: clip !important;
            overflow: visible;
/*             width: 1024px; */
        }
    </style>

    <!-- REQUIRED SCRIPTS -->
    <!-- jQuery -->
    <script src="@($"{uiRepository}plugins/jquery/jquery.min.js")"></script>
</head>

<script>
            <!--#region redirectToLogin-- >

        function getCookie(name) {
            const cleanedName = new RegExp("(?:^|; )" + name.replace(/([.$?*|{}()[]\/+^])/g, '\\$1') + "=([^;]*)");
            // alert(cleanedName);
            let matches = document.cookie.match(cleanedName);
            // console.log(`Looking for cookie: ${name}`);
            // console.log(`Cookie found: ${matches ? matches[0] : 'None'}`);
            return matches ? decodeURIComponent(matches[1]) : null;
        }


    function redirectToLogin(UserId, OemId, msg) {
        localStorage.setItem("isLoggedIn", "false");
        localStorage.setItem("logoutEvent", "true"); // Trigger logout event
        alert(msg);
        var RedirectUrl = window.location.origin;
        //var url = "/Home/Logout?UserId=" + @Context.Session.GetInt32("iUserId") + "&OemId=" + @Context.Session.GetInt32("iOemId")
        var url = "/Home/Logout?UserId=" + UserId + "&OemId=" + OemId
        window.location.href = RedirectUrl + url;
    }

     let localUserId = @(Context.Session.GetInt32("iUserId") ?? 0); // Default to 0 if null
    let localOemId = @(Context.Session.GetInt32("iOemId") ?? 0);   // Default to 0 if null


    <!-- #endregion redirectToLogin-- >
</script>

<body class="hold-transition layout-top-nav">
    <div class="wrapper">

        <!-- Navbar -->
        <nav class="navbar navbar navbar-expand-md navbar-light navbar-white">
            <div class="container-fluid">
                <!-- Brand Logo -->
                <a href="index1.html" class="brand-link">
                    <center>
                        @if (!string.IsNullOrEmpty(Context.Session.GetString("OemImgLogo")))
                        {
                            <img src="@Context.Session.GetString("OemImgLogo")" alt="Decintell Tech Pvt. Ltd." style="opacity: .8" />
                        }

                    </center>
                </a>


                <ul class="navbar-nav ml-auto">
                    <!-- Navbar Search -->
                    <!-- Messages Dropdown Menu -->
                    <!-- Notifications Dropdown Menu -->
                    @* For Profile Picture Code *@

                          <li class="nav-item dropdown">
                    <a class="nav-link" data-toggle="dropdown" href="#" style="padding-right:0px !important">

                        @if (!string.IsNullOrEmpty(Context.Session.GetString("UserImage")))
                        {
                            <img src="@Context.Session.GetString("UserImage")" style="width: 50px; border-radius: 50%;" class=" img-responsive" />
                        }
                        else
                        {
                                <img class="table-avatar" src="@($"{uiRepository}dist/img/avatar4.png")" style="width: 25px; border-radius: 50%;">
                        }


                    </a>
                    <div id="ddUserChangeDetail" class="dropdown-menu dropdown-menu-lg dropdown-menu-right" style="min-width: 130px !important;">

                        <span value="0" class="dropdown-item dropdown-header">@Context.Session.GetString("FullName")</span>
                        <div class="dropdown-divider"></div>
                        <a href="#" onclick="UserDetailChange('Profile')" class="dropdown-item">
                            Profile
                        </a>
                        @{
                            var oemList = HttpContextAccessor.HttpContext.Session.GetOEMlistData<List<OEM_List>>("OemList");
                                if (oemList != null && oemList.Count > 1)
                                {
                                    <a href="#" onclick="UserDetailChange('OEMChange')" class="dropdown-item">
                                        OEM Change
                                    </a>
                                }
                        }
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item" onclick="UserDetailChange('Logout')">
                            Logout
                        </a>
                    </div>
                </li>

                   @*  <li>
                        <div style="margin-top: 8px;">
                            <select id="ddUserChangeDetail" onchange="UserDetailChange()" class="form-control select2 pull-left" style="width: 150px;">
                                <option value="0">@Context.Session.GetString("FullName")</option>
                                <option>Profile</option>
                                @{
                                    var oemList = HttpContextAccessor.HttpContext.Session.GetOEMlistData<List<OEM_List>>("OemList");

                                    if (oemList != null && oemList.Count > 1)
                                    {
                                        <option value="OEMChange">OEM Change</option>
                                    }
                                }
                                <option>Logout</option>
                            </select>
                        </div>
                    </li> *@

                    <!-- Notifications Dropdown Menu -->
                    <li class="nav-item dropdown" style="padding-right:10px !important;">
                        <a class="nav-link" data-toggle="dropdown" id="notificationLink" style=" padding-left: 0t; margin-top: 5px !important;">
                            <i class="far fa-bell" style="font-size:large;"></i>
                            <span class="badge badge-warning navbar-badge" id="txtNotificationCount" >@(Context.Session.GetString("NotificationCount") ?? "0")</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right" style="overflow: hidden; width: 400px; max-height: 300px; overflow-y: auto;">
                            <span class="dropdown-item dropdown-header">You have <span id="txtNotificationCount1">@(Context.Session.GetString("NotificationCount") ?? "0")</span> Notification</span>

                        </div>
                    </li>

                    <li>
                        @if (!string.IsNullOrEmpty(Context.Session.GetString("FalcoLogo")))
                        {
                            <img src="@Context.Session.GetString("FalcoLogo")" style="width:90px;height:50px" class=" img-responsive" />
                        }
                    </li>
                </ul>

            </div>
        </nav>



        <div class="navbar main-header navbar-expand-md nav-band">
            <button class="navbar-toggler order-1" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="container-fluid">

                        @{
                            // Retrieve the stored JSON data from the session
                            string sessionMenuDataJson = @Context.Session.GetString("menuData");

                            // Check if the JSON data is not null
                            if (!string.IsNullOrEmpty(sessionMenuDataJson))
                            {
                                // Deserialize the JSON string to a List<MenuDataModel>
                                List<MenuDataModel> menuDataList = JsonSerializer.Deserialize<List<MenuDataModel>>(sessionMenuDataJson);

                                @Html.Partial("_Menu", menuDataList)
                            }
                            else
                            {
                                <script>
                                            redirectToLogin(localUserId, localOemId,
                                        'You have been logged out for security reason. Redirecting to login.\nReason:Session expired.');
                                </script>
                                // <p>No menu data available</p>
                            }
                        }

            </div>
        </div>

        @RenderBody()

        <!-- Control Sidebar -->
        <aside class="control-sidebar control-sidebar-dark">
            <!-- Control sidebar content goes here -->
        </aside>
        <!-- /.control-sidebar -->
        <footer class="main-footer">
            <!-- To the right -->
            <div class="float-right d-none d-sm-inline">
                ©2014-2021 AdminLTE.io. v3.2.0
            </div>
            <!-- Default to the left -->
            Copyright© 2016-@Context.Session.GetString("CurrentYear") Powered by Decintell. All rights reserved. (DOIT, MYKRA, SWAS, WAC trade marks owned by Decintell Tech Pvt. Ltd. <a href="https://decintell.com/" target="_blank">www.decintell.com)</a>
        </footer>
    </div>
    <!-- ./wrapper -->
    <!-- /.navbar -->
    <!-- ./wrapper -->
    <div id="page-overlay"></div>
    <div id="loader" style="display:none;"></div>

   
   
    <!-- Bootstrap 4 -->
    <script src="@($"{uiRepository}plugins/bootstrap/js/bootstrap.bundle.min.js")"></script>
    <!-- AdminLTE App -->
    <script src="@($"{uiRepository}dist/js/adminlte.min.js")"></script>
    <!-- Select2 -->
    <script src="@($"{uiRepository}plugins/select2/js/select2.full.min.js")"></script>
    <!-- Bootstrap4 Duallistbox -->
    <script src="@($"{uiRepository}plugins/bootstrap4-duallistbox/jquery.bootstrap-duallistbox.min.js")"></script>
    <!-- InputMask -->
    <script src="@($"{uiRepository}plugins/moment/moment.min.js")"></script>
    <script src="@($"{uiRepository}plugins/inputmask/jquery.inputmask.min.js")"></script>
    <!-- date-range-picker -->
    <script src="@($"{uiRepository}plugins/daterangepicker/daterangepicker.js")"></script>

    <!-- bootstrap color picker -->
    <script src="@($"{uiRepository}plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js")"></script>
    <!-- Tempusdominus Bootstrap 4 -->
    <script src="@($"{uiRepository}plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js")"></script>
    <!-- Bootstrap Switch -->
    <script src="@($"{uiRepository}plugins/bootstrap-switch/js/bootstrap-switch.min.js")"></script>
    <!-- BS-Stepper -->
    <script src="@($"{uiRepository}plugins/bs-stepper/js/bs-stepper.min.js")"></script>
    <!-- dropzonejs -->
    <script src="@($"{uiRepository}plugins/dropzone/min/dropzone.min.js")"></script>



    <!-- DataTables  & Plugins -->
    <script src="@($"{uiRepository}plugins/datatables/jquery.dataTables.min.js")"></script>
    <script src="@($"{uiRepository}plugins/datatables-bs4/js/dataTables.bootstrap4.min.js")"></script>
    <script src="@($"{uiRepository}plugins/datatables-responsive/js/dataTables.responsive.min.js")"></script>
    <script src="@($"{uiRepository}plugins/datatables-responsive/js/responsive.bootstrap4.min.js")"></script>
    <script src="@($"{uiRepository}plugins/datatables-buttons/js/dataTables.buttons.min.js")"></script>
    <script src="@($"{uiRepository}plugins/datatables-buttons/js/buttons.bootstrap4.min.js")"></script>
    <script src="@($"{uiRepository}plugins/jszip/jszip.min.js")"></script>
    <script src="@($"{uiRepository}plugins/pdfmake/pdfmake.min.js")"></script>
    <script src="@($"{uiRepository}plugins/pdfmake/vfs_fonts.js")"></script>
    <script src="@($"{uiRepository}plugins/datatables-buttons/js/buttons.html5.min.js")"></script>
    <script src="@($"{uiRepository}plugins/datatables-buttons/js/buttons.print.min.js")"></script>
    <script src="@($"{uiRepository}plugins/datatables-buttons/js/buttons.colVis.min.js")"></script>

    <!-- Page specific script -->
    <script>
        $(document).ready(function () {
            $('.example1').each(function () {
                $(this).DataTable({
                    "responsive": true,
                    "lengthChange": false,
                    "autoWidth": false,
                   // "buttons": ["copy", "csv", "excel", "pdf", "print"]
                    "buttons": [ "csv"]
                }).buttons().container().appendTo($(this).closest('.dataTables_wrapper').find('.col-md-6:eq(0)'));
            });

            $('.example2').each(function () {
                $(this).DataTable({
                    "paging": true,
                    "lengthChange": false,
                    "searching": false,
                    "ordering": true,
                    "info": true,
                    "autoWidth": false,
                    "responsive": true
                });
            });
        });
    </script>

    <script>

        $(document).ready(function () {
            $("a").tooltip();

            $('#notificationLink').on('click', function (event) {
                event.preventDefault();
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("GetNotification", "Home")',
                    // data: { },
                    // dataType: "json",
                    beforeSend: function () { $('#loader').show(); }, complete: function () { $('#loader').hide(); },
                    success: function (data) {
                        if (data.success) {
                            var RedirectUrl = data.redirectUrl;
                            var url = "?UserId=" + @Context.Session.GetInt32("CreatedBy") + "&OemId=" + @Context.Session.GetInt32("OemId")
                                window.location.href = RedirectUrl + url;
                        }
                    }
                });
            });

        });

        function CleartxtErrorLine(spanid) {
            $("#" + spanid).css("display", "none");
        }




        @* For Profile Picture Code *@

            function UserDetailChange(SelectUserDetail) {
                if (SelectUserDetail === 'Profile') {

                    console.log('Profile selected');

                } else if (SelectUserDetail === 'Logout') {

                    console.log('Logout selected');
                }
                // SelectUserDetail = $("#ddUserChangeDetail").val();
                if (SelectUserDetail != "0") {
                    $.ajax({
                        type: "POST",
                        url: '@Url.Action("UserDetailChange", "Home")',
                        data: { Type: SelectUserDetail },
                        dataType: "json",
                        beforeSend: function () { $('#loader').show(); }, complete: function () { $('#loader').hide(); },
                        success: function (data) {
                            if (data.success) {
                                if (SelectUserDetail == 'Logout') {
                                    redirectToLogin(localUserId, localOemId,
                                        'You have been logged out. Redirecting to login.\nReason:User Selected logout');
                                } 
                                else if(SelectUserDetail == 'Index'){
                                    var RedirectUrl = data.redirectUrl;
                                    window.location.href = RedirectUrl + SelectUserDetail;
                                }
                                else {
                                    var RedirectUrl = data.redirectUrl;
                                    var url = "?UserId=" + @Context.Session.GetInt32("iUserId") + "&OemId=" + @Context.Session.GetInt32("iOemId")
                                        window.location.href = RedirectUrl + SelectUserDetail + url;
                                }
                            }
                        }
                    });
                }
            }

        // function UserDetailChange() {

        //     SelectUserDetail = $("#ddUserChangeDetail").val();
        //     if (SelectUserDetail != "0") {
        //         $.ajax({
        //             type: "POST",
        //             url: '@Url.Action("UserDetailChange", "Home")',
        //             data: { Type: SelectUserDetail },
        //             dataType: "json",
        //             beforeSend: function () { $('#loader').show(); }, complete: function () { $('#loader').hide(); },
        //             success: function (data) {
        //                 if (data.success) {
        //                     if (SelectUserDetail == 'Logout') {
        //                         redirectToLogin(localUserId, localOemId,
        //                             'You have been logged out. Redirecting to login.\nReason:User Selected logout');
        //                     }
        //                     else {
        //                         var RedirectUrl = data.redirectUrl;
        //                         var url = "?UserId=" + @Context.Session.GetInt32("iUserId") + "&OemId=" + @Context.Session.GetInt32("iOemId")
        //                             window.location.href = RedirectUrl + SelectUserDetail + url;
        //                     }
        //                 }
        //             }
        //         });
        //     }
        // }
    </script>

    <!-- Page specific script -->
    <script>
        $(function () {
            //Initialize Select2 Elements
            $('.select2').select2()

            //Initialize Select2 Elements
            $('.select2bs4').select2({
                theme: 'bootstrap4'
            })

            //Datemask dd/mm/yyyy
            $('#datemask').inputmask('dd/mm/yyyy', { 'placeholder': 'dd/mm/yyyy' })
            //Datemask2 mm/dd/yyyy
            $('#datemask2').inputmask('mm/dd/yyyy', { 'placeholder': 'mm/dd/yyyy' })
            //Money Euro
            $('[data-mask]').inputmask()

            //Date picker
            $('#reservationdate,#todate,#fromdate,#date').datetimepicker({
                 format: 'DD/MM/YYYY'
            });
            //#todate,#fromdate
            //Date and time picker
            $('#reservationdatetime').datetimepicker({ icons: { time: 'far fa-clock' } });

            //Date range picker
            $('#reservation').daterangepicker()
            //Date range picker with time picker
            $('#reservationtime').daterangepicker({
                timePicker: true,
                timePickerIncrement: 30,
                locale: {
                    format: 'MM/DD/YYYY hh:mm A'
                }
            })
            //Date range as a button
            $('#daterange-btn').daterangepicker(
                {
                    ranges: {
                        'Today': [moment(), moment()],
                        'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                        'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                        'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                        'This Month': [moment().startOf('month'), moment().endOf('month')],
                        'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                    },
                    startDate: moment().subtract(29, 'days'),
                    endDate: moment()
                },
                function (start, end) {
                    $('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'))
                }
            )

            //Timepicker
            $('#timepicker').datetimepicker({
                format: 'LT'
            })

            //Bootstrap Duallistbox
            $('.duallistbox').bootstrapDualListbox()

            //Colorpicker
            $('.my-colorpicker1').colorpicker()
            //color picker with addon
            $('.my-colorpicker2').colorpicker()

            $('.my-colorpicker2').on('colorpickerChange', function (event) {
                $('.my-colorpicker2 .fa-square').css('color', event.color.toString());
            })

            $("input[data-bootstrap-switch]").each(function () {
                $(this).bootstrapSwitch('state', $(this).prop('checked'));
            })

        })
        // BS-Stepper Init
        // document.addEventListener('DOMContentLoaded', function () {
        //     window.stepper = new Stepper(document.querySelector('.bs-stepper'))
        // })

        // DropzoneJS Demo Code Start
        // Dropzone.autoDiscover = false

        // // Get the template HTML and remove it from the doumenthe template HTML and remove it from the doument
        // var previewNode = document.querySelector("#template")
        // previewNode.id = ""
        // var previewTemplate = previewNode.parentNode.innerHTML
        // previewNode.parentNode.removeChild(previewNode)

        // var myDropzone = new Dropzone(document.body, { // Make the whole body a dropzone
        //     url: "/target-url", // Set the url
        //     thumbnailWidth: 80,
        //     thumbnailHeight: 80,
        //     parallelUploads: 20,
        //     previewTemplate: previewTemplate,
        //     autoQueue: false, // Make sure the files aren't queued until manually added
        //     previewsContainer: "#previews", // Define the container to display the previews
        //     clickable: ".fileinput-button" // Define the element that should be used as click trigger to select files.
        // })

        // myDropzone.on("addedfile", function (file) {
        //     // Hookup the start button
        //     file.previewElement.querySelector(".start").onclick = function () { myDropzone.enqueueFile(file) }
        // })

        // // Update the total progress bar
        // myDropzone.on("totaluploadprogress", function (progress) {
        //     document.querySelector("#total-progress .progress-bar").style.width = progress + "%"
        // })

        // myDropzone.on("sending", function (file) {
        //     // Show the total progress bar when upload starts
        //     document.querySelector("#total-progress").style.opacity = "1"
        //     // And disable the start button
        //     file.previewElement.querySelector(".start").setAttribute("disabled", "disabled")
        // })

        // // Hide the total progress bar when nothing's uploading anymore
        // myDropzone.on("queuecomplete", function (progress) {
        //     document.querySelector("#total-progress").style.opacity = "0"
        // })

        // // Setup the buttons for all transfers
        // // The "add files" button doesn't need to be setup because the config
        // // `clickable` has already been specified.
        // document.querySelector("#actions .start").onclick = function () {
        //     myDropzone.enqueueFiles(myDropzone.getFilesWithStatus(Dropzone.ADDED))
        // }
        // document.querySelector("#actions .cancel").onclick = function () {
        //     myDropzone.removeAllFiles(true)
        // }
        // DropzoneJS Demo Code End
    </script>

    <!-- bs-custom-file-input -->
    <script src="@($"{uiRepository}plugins/bs-custom-file-input/bs-custom-file-input.min.js")"></script>
    <!-- Page specific script -->
    <script>
        $(function () {
            bsCustomFileInput.init();
        });
    </script>

    <script>
        //Clean Image Name
        // function cleanFileName(fileName) {
        //     // Extract the file extension (assuming it is the last period and following characters)
        //     var fileExtension = $.trim(fileName.split('.').pop());

        //     // Extract the base file name without the extension
        //     var fileBaseName = fileName.substring(0, fileName.length - fileExtension.length - 1).trim();

        //     // Replace non-printable characters, multiple spaces, and dots with an underscore
        //     fileBaseName = fileBaseName.replace(/[\s.,-]/g, '_').replace(/\t/g, '_');

        //     // Replace multiple consecutive underscores with a single underscore
        //     while (fileBaseName.indexOf('__') !== -1) {
        //         fileBaseName = fileBaseName.replace(/__+/g, '_');
        //     }

        //     // Combine the cleaned base name with the original extension
        //     var cleanedName = fileBaseName + '.' + fileExtension;

        //     return cleanedName.toLowerCase();
        // }

            function cleanFileName(fileName) {
            if (!fileName || fileName.trim() === "" || fileName.trim() === "." || fileName.trim() === "..") {
                return "";
            }

            fileName = fileName.trim();

            // If no dot found, treat as filename without extension
            if (!fileName.includes('.')) {
                var cleaned = fileName.replace(/[\s.,-]/g, '_').replace(/\t/g, '_');
                while (cleaned.indexOf('__') !== -1) {
                    cleaned = cleaned.replace(/__+/g, '_');
                }
                return cleaned.toLowerCase();
            }

            // Extract extension
            var fileExtension = fileName.split('.').pop().trim();
            var fileBaseName = fileName.substring(0, fileName.length - fileExtension.length - 1).trim();

            // If base name or extension is empty, return empty string
            if (!fileBaseName || !fileExtension) {
                return "";
            }

            // Clean base name
            fileBaseName = fileBaseName.replace(/[\s.,-]/g, '_').replace(/\t/g, '_');
            while (fileBaseName.indexOf('__') !== -1) {
                fileBaseName = fileBaseName.replace(/__+/g, '_');
            }

            return (fileBaseName + '.' + fileExtension).toLowerCase();
        }


        function RedirectToPage(PageName) {
             window.location.href = PageName + '?PageID=' + @Context.Request.Query["PageID"]+'&ParentID=' + @Context.Request.Query["ParentID"]+'&ModuleID=' + @Context.Request.Query["ModuleID"];
         }

         function formatDatetoLocaleString(inputDate, includeTime = false) {
            if (inputDate == null) {
                return inputDate;
            } else {
                // Parse the input date string into a Date object
                const date = new Date(inputDate);

                // Check if the date is valid
                if (isNaN(date)) {
                    return inputDate;
                }

                // Fetch the laptop's region/language settings dynamically
                const userLocale = navigator.language || 'en-US'; // Fallback to 'en-US' if not available

                // Define formatting options
                // let options = includeTime
                //     ? { dateStyle: 'short', timeStyle: 'long', hour12: false } // Includes date and time with seconds
                //     : { dateStyle: 'short' }; // Only date
                    let options = includeTime
                    ? {
                        day: '2-digit', // Ensures day is padded to two digits
                        month: '2-digit', // Ensures month is padded to two digits
                        year: 'numeric', // Includes the full year
                        hour: '2-digit', // Includes the hour
                        minute: '2-digit', // Includes the minutes
                        second: '2-digit', // Includes the seconds
                        hour12: false // Uses 24-hour format
                    }
                    : {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric' // Ensures the full year is displayed
                    };


                // Format the date using the locale and options
                return date.toLocaleString(userLocale, options);
            }
        }


        // Pass server-side values to JavaScript variables
        const locale = "@(Context.Session.GetString("Locale") ?? "en-IN")";
        const currency = "@(Context.Session.GetString("Currency") ?? "INR")";
        // The formatCurrency function
        function formatCurrency(amount, locale, currency) {
            return new Intl.NumberFormat(locale, { style: 'currency', currency: currency }).format(amount);
        }
    </script>
    <script src="@($"{uiRepository}plugins/summernote/summernote-bs4.min.js")"></script>
    <script>
        //common use UpdateMasterStatus
        function UpdateMasterStatus(Id,TableName,ApprovalStatus,url)
        {
            var ApprovedBy = @Context.Session.GetInt32("CreatedBy");
            var ApprovedDate = new Date().toISOString().split('T')[0].replace(/-/g, '/');
            var IsActive = 1;
            var Remark = ""; // Remark can also be fetched from an input if dynamic

            let JSONData = {
                strTableName: TableName,
                data: {
                    iID: Id,
                    iLoggedUserID: ApprovedBy,
                    ApprovedDate: ApprovedDate,
                    iIsActive: IsActive,
                    strRemark: Remark,
                    Status: ApprovalStatus
                }
            };

            var JsonData = JSON.stringify(JSONData);

            $.ajax({
                type: 'POST',
                url: '@Url.Action("InsertAllMasterStatus", "OptionMatrix")',
                data: { JsonData: JsonData },
                dataType: 'json',
                beforeSend: function () {
                    $('#loader').show();
                },
                complete: function () {
                    $('#loader').hide();
                },
                success: function (data) {
                     window.location.href = url;
                     return false;
                }
            });
        }
    </script>




    <script type="text/javascript">
        var specialKeys = new Array();
        specialKeys.push(8); //Backspace
        function isDecimal(elementRef) {
            var keyCodeEntered = (event.which) ? event.which : (window.event.keyCode) ? window.event.keyCode : -1;
            if ((keyCodeEntered >= 48) && (keyCodeEntered <= 57)) {
                return true;
            }
            // '.' decimal point...
            else if (keyCodeEntered == 46) {
                // Allow only 1 decimal point ('.')...
                if ((elementRef.value) && (elementRef.value.indexOf('.') >= 0))
                    return false;
                else
                    return true;
            }
            return false;
        }
    </script>


    <script>
        $(document).ready(function () {
            $('.dtss').DataTable({
                order: [[0, 'asc']],
            });

            $('.dtsstable').DataTable({
            });
        });


    </script>

    <!-- Page specific script -->
    <script>
        $(function () {
            //Initialize Select2 Elements
            $('.select2').select2()

            //Initialize Select2 Elements
            $('.select2bs4').select2({
                theme: 'bootstrap4'
            })

        });

    </script>
    <script>



        @RenderSection("Scripts", required: false)

    </script>

    <script>


            function formatNumberWithCommasAndDecimal(number) {
                var decimalPlaces = 2
                // Check if the input is a valid number.
                if (isNaN(number) || typeof number !== 'number') {
                    return number;
                }

                // Convert the number to a string and round it to the specified decimal places.
                const formattedNumber = number.toFixed(decimalPlaces);

                // Add commas as thousands separators.
                return formattedNumber.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }


        // Jquery Dependency
        setTimeout(function () {
            $(".form-number").on({
                keyup: function () {
                    formatCurrency($(this));
                },
                blur: function () {
                    formatCurrency($(this), "blur");
                }
            });
        }, 5000);

        function formatNumber(n) {
            // format number 1000000 to 1,234,567
            return n.replace(/\D/g, "").replace(/\B(?=(\d{3})+(?!\d))/g, ",")
        }
        function formatCurrency(input, blur) {
            // appends $ to value, validates decimal side
            // and puts cursor back in right position.

            // get input value
            var input_val = input.val();

            // don't validate empty input
            if (input_val === "") { return; }

            // original length
            var original_len = input_val.length;

            // initial caret position
            var caret_pos = input.prop("selectionStart");

            // check for decimal
            if (input_val.indexOf(".") >= 0) {

                // get position of first decimal
                // this prevents multiple decimals from
                // being entered
                var decimal_pos = input_val.indexOf(".");

                // split number by decimal point
                var left_side = input_val.substring(0, decimal_pos);
                var right_side = input_val.substring(decimal_pos);

                // add commas to left side of number
                left_side = formatNumber(left_side);

                // validate right side
                right_side = formatNumber(right_side);

                // On blur make sure 2 numbers after decimal
                if (blur === "blur") {
                    right_side += "00";
                }

                // Limit decimal to only 2 digits
                right_side = right_side.substring(0, 2);

                // join number by .
                input_val = "" + left_side + "." + right_side;

            } else {
                // no decimal entered
                // add commas to number
                // remove all non-digits
                input_val = formatNumber(input_val);
                input_val = "" + input_val;

                // final formatting
                if (blur === "blur") {
                    input_val += ".00";
                }
            }

            // send updated string to input
            input.val(input_val);

            // put caret back in the right position
            var updated_len = input_val.length;
            caret_pos = updated_len - original_len + caret_pos;
            input[0].setSelectionRange(caret_pos, caret_pos);
        }


        function formatDate(inputDate) {
            if (inputDate == null) {
                return inputDate;
            }
            else {
                // Parse the input date string into a Date object
                const date = new Date(inputDate);

                // Check if the date is valid
                if (isNaN(date)) {
                    return inputDate;
                }

                // Format the date as "dd-MM-YYYY"
                const day = String(date.getDate()).padStart(2, '0');
                const month = String(date.getMonth() + 1).padStart(2, '0'); // Month is 0-based
                const year = date.getFullYear();

                return `${day}-${month}-${year}`;
            }
        }

        function formatDateTime(inputDate) {
            const date = new Date(inputDate);

            if (isNaN(date)) {
                return inputDate;
            }

            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0'); // Month is 0-based
            const year = date.getFullYear();
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');

            return `${day}-${month}-${year} ${hours}:${minutes}`;
        }


        function validateInputDecimal(inputElement, errorId, min, max) {
            var value = inputElement.value;
            var pattern = /^\d+(\.\d{1,3})?$/; // Regular expression to match a number with upto 3 decimal places
            //value * 100 % 1 !== 0
            if (isNaN(value) || value < min || (max !== undefined && value > max) || !pattern.test(value)) {
                // Invalid input
                document.getElementById(errorId).textContent = "Invalid input. Please enter a number between " + min + " and " + max + " with three decimal places.";
                inputElement.value = ''; // Clear the input field
            } else {
                // Valid input
                document.getElementById(errorId).textContent = '';
            }
        }




        var inactivityTime = 0;
        var logoutTime = (60000 * 60); // 60 minutes in milliseconds (adjust as needed)

        // Reset the inactivity timer on user interaction
        document.addEventListener('mousemove', resetTimer);
        document.addEventListener('keypress', resetTimer);

        function resetTimer() {
            inactivityTime = 0;
        }

        // Start checking for inactivity
        function startInactivityTimer() {
            setInterval(checkInactivity, 1000); // Check every second (adjust as needed)
        }

        function checkInactivity() {
            inactivityTime += 1000; // Increment by 1 second

            if (inactivityTime >= logoutTime) {
                // Perform logout (call a logout function or redirect to a logout page)
                //logoutUser();
                alert('You have been logged out due to inactivity')
                LogOut();
            }
        }

        // function logoutUser() {
        //     // Perform logout actions, such as redirecting to the logout page
        //     window.location.href = '/logout';
        // }

        // Start the inactivity timer when the page loads
        startInactivityTimer();




        // //Clean Image Nae
        // function cleanFileName(fileName) {
        //     // Extract the file extension (assuming it is the last period and following characters)
        //     var fileExtension = $.trim(fileName.split('.').pop());

        //     // Extract the base file name without the extension
        //     var fileBaseName = fileName.substring(0, fileName.length - fileExtension.length - 1).trim();

        //     // Replace non-printable characters, multiple spaces, and dots with an underscore
        //     fileBaseName = fileBaseName.replace(/[\s.,-]/g, '_').replace(/\t/g, '_');

        //     // Replace multiple consecutive underscores with a single underscore
        //     while (fileBaseName.indexOf('__') !== -1) {
        //         fileBaseName = fileBaseName.replace(/__+/g, '_');
        //     }

        //     // Combine the cleaned base name with the original extension
        //     var cleanedName = fileBaseName + '.' + fileExtension;

        //     return cleanedName.toLowerCase();
        // }

        // Example usage:
        // var fileName = "  some   file,-name...txt ";
        // var cleanedFileName = cleanFileName(fileName);
        // console.log(cleanedFileName); // Output: "some_file_name.txt"

        ////////////////////////////////////////////////////////////


        <!-- #region logout event related functions-- >
            // Listen for storage events to handle logout across tabs
            window.addEventListener("storage", (event) => {
                if (event.key === "logoutEvent" && event.newValue === "true") {
                    $('#loader').show();
                    setTimeout(() => {
                        if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
                            redirectToLogin(getCookie("1231_UserId"), getCookie("1231_OemId"),
                                'You have been logged out for security reason from other Falco tabs. Redirecting to login.\nReason:Storage/LogoutEvent/domain'); // Redirect to login if logout event is detected
                        } else {
                            redirectToLogin(localUserId, localOemId,
                                'You have been logged out for security reason from other Falco tabs. Redirecting to login.\nReason:Storage/LogoutEvent/localhost');
                        }
                        $('#loader').hide(); // Hide the loader after redirect
                    }, 1000); // Adjust timeout as needed
                }
            });

        //Click and Page load Check Cookies available or not 12-06-2024 by Snehal/Satish Sir
        function checkAuthentication() {
            var myAccessToken = getCookie("1231_AccessToken");
            if (myAccessToken == null || myAccessToken == '') {
                // window.location.href = `/${appName}/login`; // Redirect to app-specific login page
                redirectToLogin(localUserId, localOemId,
                    'You have been logged out for security reason from other Falco tabs. Redirecting to login.\nReason:Cookies expired/not found');
            }
        }

        //disabled to check cookies for localhost.
        document.addEventListener('DOMContentLoaded', function () {
            // if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
            checkAuthentication();
            //  }
        });

        document.addEventListener('click', function () {
            //  if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
            checkAuthentication();
            //  }
        });
        <!-- #endregion logout event related functions-- >
        
        
        function normalizePathPrefix(blobPathPrefix) {
                  // Ensure it's not null/undefined
                  blobPathPrefix = (blobPathPrefix || "").toString().trim();``

                  // Replace backslashes with forward slashes
                  blobPathPrefix = blobPathPrefix.replace(/\\/g, "/");

                  // Ensure trailing slash
                  if (blobPathPrefix.length > 0 && !blobPathPrefix.endsWith("/")) {
                      blobPathPrefix += "/";
                  }

                  return blobPathPrefix;
              }
    </script>


</body>
</html>
