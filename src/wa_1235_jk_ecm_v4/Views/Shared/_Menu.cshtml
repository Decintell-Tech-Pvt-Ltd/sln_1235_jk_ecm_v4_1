@using System.Text.Json
@using wa_1235_jk_ecm_v4.Models.DecintellCommon
@model List<MenuDataModel>

<div class="collapse navbar-collapse order-3" id="navbarCollapse">
    <div id="carouselExampleControlsNoTouching" class="carousel slide" data-touch="false" data-interval="false">
        <div class="carousel-inner">
            @{
                int groupSize = 14; // Number of items per carousel
                int totalItems = Model.Count;
                int currentIndex = 0;
            }

            @foreach (var group in Model.Chunk(groupSize))
            {
                // Determine if this is the active carousel-item
                string activeClass = currentIndex == 0 ? "active" : string.Empty;

                <div class="carousel-item @activeClass">
                    <ul class="navbar-nav">
                        @foreach (var item in group)
                        {
                            var uniqueId = "dropdownSubMenu" + currentIndex.ToString() + item.id; // Creating dynamic ID using the index and item ID
                            <li class="nav-item dropdown">
                               @if (!string.IsNullOrEmpty(@Context.Request.Query["ModuleId"])
                               && int.TryParse(@Context.Request.Query["ModuleId"], out int moduleId)
                               && moduleId == @item.ModuleId)
                                {
                                    <a id="@uniqueId" href="@item.href" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="nav-link dropdown-toggle" title="@item.label">
                                        @item.label
                                    </a>
                                }
                                else
                                {
                                    <a id="@uniqueId" href="@item.href" class="nav-link dropdown-toggle" title="@item.label">
                                        @item.label
                                    </a>
                                }

                                @if (item.ul != null && item.ul.Any())
                                {
                                    <ul aria-labelledby="@uniqueId" class="dropdown-menu border-0 shadow">
                                        @foreach (var subItem in item.ul)
                                        {
                                            if (subItem is JsonElement jsonElement)
                                            {
                                                // Manually deserialize the JSON object
                                                MenuDataModel subMenu = JsonSerializer.Deserialize<MenuDataModel>(jsonElement.GetRawText());

                                                if (subMenu != null)
                                                {
                                                    @Html.Partial("_DropdownMenu", new List<MenuDataModel> { subMenu })
                                                }
                                            }
                                        }
                                    </ul>
                                }
                            </li>
                            currentIndex++;
                        }
                    </ul>
                </div>
            }
        </div>
        <button class="carousel-control-prev" type="button" data-target="#carouselExampleControlsNoTouching" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true" style="font-size: 14px;"></span>
            <span class="sr-only">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-target="#carouselExampleControlsNoTouching" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
        </button>
    </div>
</div>


